<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–¢–µ—Å—Ç API GoalUp</title>
<style>
  body {
    font-family: "JetBrains Mono", monospace;
    background: #1a1a2e;
    color: #eee;
    padding: 20px;
  }
  h1 { color: #ffd700; }
  input, select {
    padding: 8px 10px;
    font-size: 15px;
    border-radius: 8px;
    border: 1px solid #444;
    background: #fff;
    color: #000;
    margin-right: 8px;
  }
  input { width: 220px; }
  #idInput { width: 100px; text-align: center; }
  button {
    padding: 8px 16px;
    background: #4a148c;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
  }
  button:hover { background: #6a1b9a; }
  pre {
    background: #111;
    padding: 16px;
    border-radius: 10px;
    color: #0f0;
    margin-top: 20px;
    overflow-x: auto;
  }
  .admin { color: #ff5050; font-weight: 700; }
</style>
</head>
<body>
  <h1>üöÄ –¢–µ—Å—Ç API GoalUp</h1>
  <p>–í–≤–µ–¥–∏ API-–∫–ª—é—á, –≤—ã–±–µ—Ä–∏ –∑–∞–ø—Ä–æ—Å –∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) ID:</p>

  <div style="margin-bottom:10px;">
    <input id="apiKey" placeholder="–í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π X-API-KEY">
    <select id="endpoint">
      <option value="goals/">–°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π</option>
      <option value="goal_id">–¶–µ–ª—å –ø–æ ID</option>
      <option value="user_id">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ ID</option>
      <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
      <option value="all_goals/" class="admin">–í—Å–µ —Ü–µ–ª–∏ (–∞–¥–º–∏–Ω)</option>
      <option value="all_users/" class="admin">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∞–¥–º–∏–Ω)</option>
    </select>
    <input id="idInput" placeholder="ID">
    <button onclick="sendRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <pre id="output">{}</pre>

<script>
async function sendRequest() {
  const key = document.getElementById("apiKey").value.trim();
  const endpointChoice = document.getElementById("endpoint").value;
  const id = document.getElementById("idInput").value.trim();
  const output = document.getElementById("output");

  if (!key) return alert("–í–≤–µ–¥–∏ API-–∫–ª—é—á!");

  let endpoint;
  if (endpointChoice === "goal_id") {
    if (!id) return alert("–í–≤–µ–¥–∏ ID —Ü–µ–ª–∏");
    endpoint = `goals/${id}/`;
  } else if (endpointChoice === "user_id") {
    if (!id) return alert("–í–≤–µ–¥–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");
    endpoint = `users/${id}/`;
  } else {
    endpoint = endpointChoice;
  }

  const url = `/api/${endpoint}`;
  output.textContent = "‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å...\n" + url;

  try {
    const start = performance.now();
    const res = await fetch(url, { headers: { "X-API-KEY": key } });
    const time = (performance.now() - start).toFixed(1);
    const text = await res.text();

    let formatted;
    try {
      formatted = JSON.stringify(JSON.parse(text), null, 2);
    } catch {
      formatted = text;
    }

    output.textContent = `URL: ${url}\nHTTP ${res.status} (${time} ms)\n\n${formatted}`;
  } catch (err) {
    output.textContent = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: " + err;
  }
}
</script>
</body>
</html>
