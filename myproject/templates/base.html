{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}GoalUp{% endblock %}</title>

    <!-- ========== –°—Ç–∏–ª–∏ ========== -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_mobile.css' %}">

    <!-- Cropper.js (–æ–±—Ä–µ–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

    <!-- –ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ -->
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <!-- ========== –®–∞–ø–∫–∞ ========== -->
    <header>
        <div class="header-left">
            <h1><a href="{% url 'welcome' %}">GoalUp</a></h1>
        </div>

        <div class="header-right">
            <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
            <button class="mobile-menu-btn" id="mobileMenuToggle">‚ò∞</button>

            <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
            <div class="mobile-actions" id="mobileActionsMenu">
              <a href="#" class="open-goal-modal">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</a>
              <a href="{% url 'planner:goals_list' %}">–ú–æ–∏ —Ü–µ–ª–∏</a>
              <a href="{% url 'planner:home' %}">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
            </div>

            {% if user.is_authenticated %}
            <div class="header-actions capsule">
              <a href="#" class="open-goal-modal capsule-btn">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</a>
              <a href="{% url 'planner:goals_list' %}" class="capsule-btn">–ú–æ–∏ —Ü–µ–ª–∏</a>
              <a href="{% url 'planner:home' %}" class="capsule-btn">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
            </div>

            <a href="{% url 'users:profile' %}" class="user-info-link">
                {% if user.userprofile.avatar %}
                    <img src="{{ user.userprofile.avatar.url }}" alt="" class="avatar-small">
                {% else %}
                    <img src="{% static 'img/default-avatar.png' %}" alt="" class="avatar-small">
                {% endif %}
                <span class="username">{{ user.username }}</span>
            </a>
            <a href="{% url 'users:logout' %}" class="btn-nav">–í—ã–π—Ç–∏</a>

            {% else %}
                <a href="{% url 'users:login' %}" class="btn-nav">–í—Ö–æ–¥</a>
                <a href="{% url 'users:register' %}" class="btn-nav">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>
    </header>

    <!-- ========== –°–æ–æ–±—â–µ–Ω–∏—è Django ========== -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
                {{ message }}
                <span class="close-btn" onclick="this.parentElement.style.display='none';">√ó</span>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ========== –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç ========== -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- ========== –§—É—Ç–µ—Ä ========== -->
    <footer class="site-footer">
      <div class="footer-container">
        <div class="footer-col about">
          <h2>GOALUP</h2>
          <p>–û–Ω–ª–∞–π–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–ª–µ–π.</p>
          <p class="rights">¬© 2025 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.<br>
          –û–±–ª–∞–¥–∞—Ç–µ–ª—å –ø—Ä–∞–≤ ‚Äî <strong>–ü–æ—Ç—É–¥–∞–Ω—Å–∫–∏–π –ö–∏—Ä–∏–ª–ª</strong></p>
        </div>

        <div class="footer-col contacts">
          <h3>–ö–û–ù–¢–ê–ö–¢–´</h3>
          <ul>
            <li><a href="https://wa.me/77059646588" target="_blank">WhatsApp: –Ω–∞–ø–∏—Å–∞—Ç—å</a></li>
            <li class="time">–û—Ç–≤–µ—á–∞—é —Å –ø–Ω –ø–æ –ø—Ç —Å 10:00 –¥–æ 22:00</li>
          </ul>
        </div>

        <div class="footer-col nav">
          <h3>–ù–ê–í–ò–ì–ê–¶–ò–Ø</h3>
          <ul>
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="{% url 'planner:home' %}">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a></li>
            <li><a href="{% url 'planner:goals_list' %}">–ú–æ–∏ —Ü–µ–ª–∏</a></li>
            <li><a href="{% url 'users:profile' %}">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, 2025
      </div>
    </footer>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div id="toast-container"></div>

    <!-- ========== –°–∫—Ä–∏–ø—Ç—ã ========== -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="{% static 'js/password_toggle.js' %}"></script>
    <script src="{% static 'js/toast.js' %}"></script>

    <!-- üîë –í–ê–ñ–ù–û: —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–ª—è fallback -->
    <script>
        window.GOALUP_HOME_URL = "{% url 'planner:home' %}";
    </script>

    <script src="{% static 'js/goal_modal.js' %}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (window.lucide) lucide.createIcons();

            const toggle = document.getElementById("mobileMenuToggle");
            const menu = document.getElementById("mobileActionsMenu");

            if (toggle && menu) {
                toggle.addEventListener("click", () => {
                    menu.classList.toggle("show");
                });
                document.addEventListener("click", (e) => {
                    if (!menu.contains(e.target) && !toggle.contains(e.target)) {
                        menu.classList.remove("show");
                    }
                });
            }
        });
    </script>

    {% block extra_js %}{% endblock %}

    <div id="loader-overlay">
        <div class="spinner"></div>
    </div>
</body>
</html>
