{% extends "base.html" %}
{% load static %}
{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è{% endblock %}
{% block content %}
<div class="form-container">
    <h2>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="field">
            <label for="id_username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            {{ form.username }}
        </div>

        <div class="field">
            <label for="id_password1">–ü–∞—Ä–æ–ª—å:</label>
            <div class="password-wrapper">
                {{ form.password1 }}
                <button type="button" class="toggle-password">
                    <i data-lucide="eye"></i>
                </button>
            </div>
        </div>

        <!-- üî• –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–∞—Ä–æ–ª—è (–∫–∞–∫ –≤ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è) -->
        <div class="password-hints" id="register-password-hints">
            <ul>
                <li>–ü–∞—Ä–æ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –ø–æ—Ö–æ–∂ –Ω–∞ –¥—Ä—É–≥—É—é –≤–∞—à—É –ª–∏—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.</li>
                <li>–í–∞—à –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤.</li>
                <li>–ü–∞—Ä–æ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç—ã–º –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º.</li>
                <li>–ü–∞—Ä–æ–ª—å –Ω–µ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ —Ü–∏—Ñ—Ä.</li>
            </ul>
        </div>
        <!-- /–∫–æ–Ω–µ—Ü –ø–æ–¥—Å–∫–∞–∑–æ–∫ -->

        <div class="field">
            <label for="id_password2">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
            <div class="password-wrapper">
                {{ form.password2 }}
                <button type="button" class="toggle-password">
                    <i data-lucide="eye"></i>
                </button>
            </div>
        </div>

        <div class="field avatar-field">
            <label>–ê–≤–∞—Ç–∞—Ä:</label>
            <div class="avatar-preview" id="avatarPreviewBlock" style="display:none;">
                <img id="avatarPreview" alt="avatar">
            </div>
            <input type="file" id="id_avatar" name="avatar" accept="image/*" hidden>
            <label for="id_avatar" class="btn btn-alt">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</label>
        </div>

        <div class="field">
            <label for="id_bio">–û —Å–µ–±–µ:</label>
            {{ form.bio }}
        </div>

        <button type="submit" class="btn btn-alt">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ -->
<div id="cropperModal" class="modal hidden">
  <div class="modal-content">
    <h3>–û–±—Ä–µ–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞</h3>
    <div class="modal-image-wrapper">
      <img id="cropperImage" alt="avatar">
    </div>
    <div style="margin-top:14px; display:flex; gap:10px; justify-content:center;">
      <button type="button" class="btn" id="cropConfirm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button type="button" class="btn btn-alt" id="cropCancel">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

{% block extra_js %}
<script src="{% static 'js/avatar_crop.js' %}"></script>
<script>
  // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
  document.addEventListener("DOMContentLoaded", () => {
    const pwd = document.getElementById("id_password1");
    const hints = document.getElementById("register-password-hints");
    if (pwd && hints) {
      hints.style.display = "none";
      pwd.addEventListener("focus", () => hints.style.display = "");
      pwd.addEventListener("blur", () => {
        setTimeout(() => {
          if (document.activeElement !== pwd) hints.style.display = "none";
        }, 150);
      });
    }
  });
</script>
{% endblock %}
{% endblock %}
